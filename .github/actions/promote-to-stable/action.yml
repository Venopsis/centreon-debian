name: "promote testing to stable"
description: "Promote testing packages to stable."
inputs:
  artifactory_token:
    description: "Artifactory token"
    required: true
  module:
    description: "Module"
    required: true

runs:
  using: "composite"
  steps:
    - uses: jfrog/setup-jfrog-cli@v3
      env:
        JF_URL: https://centreon.jfrog.io
        JF_ACCESS_TOKEN: ${{ inputs.artifactory_token }}

    - name: Promote package
      run: |
        REPO="stable"
        echo "[DEBUG] - Promote to repository: $REPO"
        TARGET="rpm/standard/23.04/el8/stable/noarch/RPMS/"

        echo "[DEBUG] - Get artifacts to promote."
        ARTIFACTS=$(jf rt s --fail-no-op rpm/standard/23.04/el8/testing/noarch/gorgone/centreon-gorgone-23.04.0-1/*.rpm | jq -r '.[].path')

        for PATH in $ARTIFACTS
        do
          echo "[DEBUG] - Promoting $PATH"
        done

      shell: bash
